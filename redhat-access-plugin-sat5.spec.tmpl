%define version 1.0.0

Name: redhat-access-plugin-sat5
Version:  %{version}
Release: $release%{?dist}
Summary:  Red Hat Access Plugin for Satellite 5.7
Group:  Applications/System 
License:  MIT
#set $i = 0
#for $artifact in $all_artifacts
Source$i: $artifact
#set $i += 1
#end for
BuildArch: noarch
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

%description
Red Hat Access Plugin for Satellite 5.7


%prep
#import zipfile
#set $i = 0
#for $artifact in $all_artifacts
   #if $artifact.endswith('-sources.zip')
     #set $sourcezip = zipfile.ZipFile($artifact)
     #set $entry = $sourcezip.namelist()[0]
     #set $source_rootdir = $entry.split('/')[0]
%setup -q -T -b $i -n $source_rootdir
   #end if
   #set $i += 1
#end for


%build


%install
echo `pwd`
echo `ls`
rm -rf %{buildroot}
#httpd.conf
mkdir -p %{buildroot}/etc/httpd/conf.d
cp source/rh-insights-sat5.conf %{buildroot}/etc/httpd/conf.d
#js
mkdir -p %{buildroot}/var/www/html/javascript
cp source/gui/dist/scripts/insights.js %{buildroot}/var/www/html/javascript
#css
mkdir -p %{buildroot}/var/www/html/css
cp source/gui/dist/styles/insights.css %{buildroot}/var/www/html/css
#war
#set $i = 0
#for $artifact in $all_artifacts
#if $artifact.endswith('.war')
mkdir -p %{buildroot}/usr/share/tomcat6/webapps
cp %{SOURCE$i} %{buildroot}/usr/share/tomcat6/webapps
#end if
#set $1 += 1
#end for
#jsp files
mkdir -p %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/admin
mkdir -p %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/sdc
cp source/jsp/admin/insights.jsp %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/admin
cp source/jsp/systems/insights.jsp %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems
cp source/jsp/systems/sdc/insights.jsp %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/sdc
#log
mkdir -p %{buildroot}/var/log/rhai
touch %{buildroot}/var/log/rhai/rhai.log
#properties file
mkdir -p %{buildroot}/etc/redhat-access/
cp source/resources/redhat-access-insights.properties %{buildroot}/etc/redhat-access/redhat-access-insights.properties
cp source/resources/rhai.keystore %{buildroot}/etc/redhat-access/rhai.keystore


%files
%defattr(0644,root,root)
%config /etc/httpd/conf.d/rh-insights-sat5.conf
%config(noreplace) %attr(0644,tomcat,tomcat) /etc/redhat-access/redhat-access-insights.properties
/etc/redhat-access/rhai.keystore
/var/www/html/javascript/insights.js
/var/www/html/css/insights.css
/usr/share/tomcat6/webapps/redhat_access.war
/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/insights.jsp
/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/sdc/insights.jsp
/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/admin/insights.jsp
%attr(0755,tomcat,root) /var/log/rhai/
%attr(0644,tomcat,tomcat) /var/log/rhai/rhai.log


%changelog
* Mon Jun 8 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0-2
- Version 1.0-2

* Mon Jun 8 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0-1
- Version 1.0-1

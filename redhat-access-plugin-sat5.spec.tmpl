%define version 1.2.0

Name: redhat-access-plugin-sat5
Version:  %{version}
Requires: spacewalk-java >= 2.3.8-106
Release: $release%{?dist}
Summary:  Red Hat Access Plugin for Satellite 5.7
Group:  Applications/System 
License:  MIT
#set $i = 0
#for $artifact in $all_artifacts
Source$i: $artifact
#set $i += 1
#end for
BuildArch: noarch
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

%description
Red Hat Access Plugin for Satellite 5.7


%prep
#import zipfile
#set $i = 0
#for $artifact in $all_artifacts
   #if $artifact.endswith('-sources.zip')
     #set $sourcezip = zipfile.ZipFile($artifact)
     #set $entry = $sourcezip.namelist()[0]
     #set $source_rootdir = $entry.split('/')[0]
%setup -q -T -b $i -n $source_rootdir
   #end if
   #set $i += 1
#end for


%build


%install
echo `pwd`
echo `ls`
rm -rf %{buildroot}
#httpd.conf
mkdir -p %{buildroot}/etc/httpd/conf.d
cp resources/rh-insights-sat5.conf %{buildroot}/etc/httpd/conf.d
#js
mkdir -p %{buildroot}/var/www/html/javascript
cp gui/dist/scripts/insights.js %{buildroot}/var/www/html/javascript
cp gui/dist/scripts/insights.app.js %{buildroot}/var/www/html/javascript
#css
mkdir -p %{buildroot}/var/www/html/css
cp gui/dist/styles/insights.css %{buildroot}/var/www/html/css
#war
#set $i = 0
#for $artifact in $all_artifacts
#if $artifact.endswith('.war')
mkdir -p %{buildroot}/usr/share/tomcat6/webapps
cp %{SOURCE$i} %{buildroot}/usr/share/tomcat6/webapps/redhat_access.war
#end if
#set $i += 1
#end for
#jsp files
mkdir -p %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/admin
mkdir -p %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/sdc
cp jsp/admin/insights.jsp %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/admin
cp jsp/systems/insights.jsp %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems
cp jsp/systems/sdc/insights.jsp %{buildroot}/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/sdc
#log
mkdir -p %{buildroot}/var/log/rhn
touch %{buildroot}/var/log/rhn/rhai.log
#properties file
mkdir -p %{buildroot}/etc/redhat-access/
cp resources/redhat-access-insights.properties %{buildroot}/etc/redhat-access/redhat-access-insights.properties
cp resources/rhai.keystore %{buildroot}/etc/redhat-access/rhai.keystore
#console helper
mkdir -p %{buildroot}/etc/pam.d
cp resources/redhat-access-systemid.pam %{buildroot}/etc/pam.d/redhat-access-systemid
mkdir -p %{buildroot}/usr/sbin
cp resources/redhat-access-systemid_wrapper.sh %{buildroot}/usr/sbin/redhat-access-systemid-wrapper
ln -s /usr/bin/consolehelper %{buildroot}/usr/sbin/redhat-access-systemid
mkdir -p %{buildroot}/etc/security/console.apps
cp resources/redhat-access-systemid_console.apps %{buildroot}/etc/security/console.apps/redhat-access-systemid
#dan's people page gpg key
mkdir -p %{buildroot}/var/www/html/pub
cp resources/rhinsights.gpg %{buildroot}/var/www/html/pub/rhinsights.gpg


%files
%defattr(0644,root,root)
%config /etc/httpd/conf.d/rh-insights-sat5.conf
%config(noreplace) %attr(0644,tomcat,tomcat) /etc/redhat-access/redhat-access-insights.properties
/etc/redhat-access/rhai.keystore
/var/www/html/javascript/insights.js
/var/www/html/javascript/insights.app.js
/var/www/html/css/insights.css
/usr/share/tomcat6/webapps/redhat_access.war
/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/insights.jsp
/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/systems/sdc/insights.jsp
/usr/share/tomcat6/webapps/rhn/WEB-INF/pages/admin/insights.jsp
%attr(0644,tomcat,tomcat) /var/log/rhn/rhai.log
/etc/pam.d/redhat-access-systemid
/etc/security/console.apps/redhat-access-systemid
%attr(0750,root,tomcat) /usr/sbin/redhat-access-systemid-wrapper
%attr(0750,root,tomcat) /usr/sbin/redhat-access-systemid
/var/www/html/pub/rhinsights.gpg


%changelog
* Mon Jul 6 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.2.0-22
- Move log file to /var/log/rhn/rhai.log
- Add dependency on spacewalk-java
- Remove username/password from GUI
- Sprinkle in links to getting started and info pages

* Thu Jul 2 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.1.1-20
- Refactor

* Tue Jun 23 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.1.0-17
- Minimize insights.js initial load size

* Fri Jun 19 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0.5-16
- Update repo location

* Thu Jun 18 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0.4-15
- CSS bug fixes

* Wed Jun 17 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0.3-13
- Upgrade insights to 3.0.6

* Wed Jun 10 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0.2-1
- Add Dan's people page repo's gpg key

* Mon Jun 8 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0.1-1
- Version 1.0-3

* Mon Jun 8 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0.0-2
- Version 1.0-2

* Mon Jun 8 2015 Chris Kyrouac <ckyrouac@redhat.com> - 1.0.0-1
- Version 1.0-1
